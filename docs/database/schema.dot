digraph QuantumMartSchema {
    rankdir=LR;
    node [shape=plaintext, fontname="Helvetica"];

    /* USERS */
    users [
        label=<
            <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0">
                <TR><TD BGCOLOR="#d0d0ff"><B>users</B></TD></TR>
                <TR><TD>id PK (UUID)</TD></TR>
                <TR><TD>username</TD></TR>
                <TR><TD>password_hash</TD></TR>
                <TR><TD>email</TD></TR>
                <TR><TD>coin_balance</TD></TR>
                <TR><TD>role</TD></TR>
                <TR><TD>created_at</TD></TR>
            </TABLE>
        >
    ];

    /* ITEM LISTINGS */
    item_listings [
        label=<
            <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0">
                <TR><TD BGCOLOR="#ffd9b3"><B>item_listings</B></TD></TR>
                <TR><TD>id PK (UUID)</TD></TR>
                <TR><TD>seller_id FK</TD></TR>
                <TR><TD>title</TD></TR>
                <TR><TD>description</TD></TR>
                <TR><TD>price</TD></TR>
                <TR><TD>image_url</TD></TR>
                <TR><TD>created_at</TD></TR>
                <TR><TD>updated_at</TD></TR>
            </TABLE>
        >
    ];

    /* CART ITEMS */
    cart_items [
        label=<
            <TABLE BORDER="1" CELLBORDER="0" CELLSPACING="0">
                <TR><TD BGCOLOR="#e6ffe6"><B>cart_items</B></TD></TR>
                <TR><TD>cart_item_id PK (UUID)</TD></TR>
                <TR><TD>user_id FK</TD></TR>
                <TR><TD>listing_id FK</TD></TR>
                <TR><TD>quantity</TD></TR>
            </TABLE>
        >
    ];

    /* ORDERS */
    orders [
        label=<
            <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0">
                <TR><TD BGCOLOR="#ffe6e6"><B>orders</B></TD></TR>
                <TR><TD>order_id PK (UUID)</TD></TR>
                <TR><TD>buyer_id FK</TD></TR>
                <TR><TD>status</TD></TR>
                <TR><TD>total_paid</TD></TR>
                <TR><TD>created_at</TD></TR>
                <TR><TD>shipping_firstname</TD></TR>
                <TR><TD>shipping_lastname</TD></TR>
                <TR><TD>shipping_address1</TD></TR>
                <TR><TD>shipping_address2</TD></TR>
                <TR><TD>shipping_city</TD></TR>
                <TR><TD>shipping_state</TD></TR>
                <TR><TD>shipping_zip</TD></TR>
                <TR><TD>shipping_phone</TD></TR>
            </TABLE>
        >
    ];

    /* ORDER ITEMS */
    order_items [
        label=<
            <TABLE BORDER="1" CELLBORDER="1" CELLSPACING="0">
                <TR><TD BGCOLOR="#fff2cc"><B>order_items</B></TD></TR>
                <TR><TD>order_item_id PK (UUID)</TD></TR>
                <TR><TD>order_id FK</TD></TR>
                <TR><TD>listing_id FK</TD></TR>
                <TR><TD>seller_id FK</TD></TR>
                <TR><TD>quantity</TD></TR>
                <TR><TD>price_each</TD></TR>
                <TR><TD>status</TD></TR>
                <TR><TD>paid_at</TD></TR>
            </TABLE>
        >
    ];

    /* RELATIONSHIPS */

    /* users → item_listings (seller) */
    users -> item_listings [label="seller_id"];

    /* users → cart_items */
    users -> cart_items [label="user_id"];

    /* item_listings → cart_items */
    item_listings -> cart_items [label="listing_id"];

    /* users → orders (buyer) */
    users -> orders [label="buyer_id"];

    /* orders → order_items */
    orders -> order_items [label="order_id"];

    /* item_listings → order_items */
    item_listings -> order_items [label="listing_id"];

    /* users → order_items (seller) */
    users -> order_items [label="seller_id"];
}